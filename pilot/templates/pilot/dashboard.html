{% extends "pilot/base.html" %}

{% block title %}Dashboard â€“ Pilot'Ã‰clair{% endblock %}

{% block content %}
    <h1 class="text-3xl font-bold mb-6 text-center text-cacf-green">ðŸ“Š Suivi des KPIs â€“ Pilot'Ã‰clair</h1>

    <!-- Formulaire de filtre -->
    <form method="get" class="mb-6 flex flex-col md:flex-row items-center gap-4 justify-center">
        <div>
            <label for="date" class="text-sm font-semibold">Date :</label>
            <input type="date" id="date" name="date" value="{{ date_selected }}"
                   class="border border-cacf-mediumgray rounded px-2 py-1">
        </div>

        <div>
            <label for="categorie" class="text-sm font-semibold">CatÃ©gorie :</label>
            <select name="categorie" id="categorie" class="border border-cacf-mediumgray rounded px-2 py-1">
                <option value="">-- Toutes --</option>
                {% for key, label in categories %}
                    <option value="{{ key }}" {% if key == categorie_selected %}selected{% endif %}>
                        {{ label }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="flex items-center gap-2">
            <button type="submit" class="bg-cacf-green text-white px-4 py-1 rounded hover:bg-cacf-dark">
                Appliquer
            </button>
            {% if filter_applied %}
                <a href="{% url 'dashboard' %}" class="text-sm text-cacf-alert underline">RÃ©initialiser</a>
            {% endif %}
        </div>
    </form>

    <!-- Affichage des KPIs -->
    {% if kpis %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% for kpi in kpis %}
                <div class="bg-white shadow rounded-xl p-5 border border-cacf-mediumgray">
                    <h2 class="text-xl font-semibold mb-2">
                        <a href="{% url 'kpi-detail' kpi.pk %}" class="text-cacf-green hover:underline">
                            {{ kpi.nom }}
                        </a>
                    </h2>
                    <p><strong>Valeur actuelle :</strong> {{ kpi.valeur_actuelle }}</p>
                    <p><strong>Objectif :</strong> {{ kpi.objectif }}</p>
                    <p><strong>Ã‰cart :</strong> 
                        {% if kpi.ecart > 0 %}
                            <span class="text-cacf-green font-bold">+{{ kpi.ecart }}</span>
                        {% elif kpi.ecart < 0 %}
                            <span class="text-cacf-alert font-bold">{{ kpi.ecart }}</span>
                        {% else %}
                            <span class="text-cacf-mediumgray">0</span>
                        {% endif %}
                    </p>
                    <p><strong>CatÃ©gorie :</strong> {{ kpi.get_categorie_display }}</p>
                    <p class="text-sm text-cacf-mediumgray mt-2">Date : {{ kpi.date }}</p>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-center text-cacf-mediumgray">Aucun KPI disponible pour le moment.</p>
    {% endif %}
{% endblock %}
