{% extends "pilot/base.html" %}

{% block title %}Dashboard â€“ Pilot'Ã‰clair{% endblock %}

{% block content %}
    <h1 class="text-3xl font-bold mb-6 text-center">ðŸ“Š Suivi des KPIs â€“ Pilot'Ã‰clair</h1>

    {% if kpis %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% for kpi in kpis %}
                <div class="bg-white shadow rounded-xl p-5">
                    <h2 class="text-xl font-semibold mb-2">
                        <a href="{% url 'kpi-detail' kpi.pk %}" class="text-blue-600 hover:underline">
                            {{ kpi.nom }}
                        </a>
                    </h2>
                    <p><strong>Valeur actuelle :</strong> {{ kpi.valeur_actuelle }}</p>
                    <p><strong>Objectif :</strong> {{ kpi.objectif }}</p>
                    <p><strong>Ã‰cart :</strong> 
                        <form method="get" class="mb-6 flex items-center gap-3">
                            <label for="date" class="text-sm font-semibold">Filtrer par date :</label>
                            <input type="date" id="date" name="date" value="{{ date_selected }}"
                                   class="border rounded px-2 py-1">
                            <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">
                                Appliquer
                            </button>
                            {% if filter_applied %}
                                <a href="{% url 'dashboard' %}" class="text-sm text-red-600 underline ml-3">RÃ©initialiser</a>
                            {% endif %}
                        </form>
                        
                        {% if kpi.ecart > 0 %}
                            <span class="text-green-600 font-bold">+{{ kpi.ecart }}</span>
                        {% elif kpi.ecart < 0 %}
                            <span class="text-red-600 font-bold">{{ kpi.ecart }}</span>
                        {% else %}
                            <span class="text-gray-600">0</span>
                        {% endif %}
                    </p>
                    <p class="text-sm text-gray-500 mt-2">Date : {{ kpi.date }}</p>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-center text-gray-600">Aucun KPI disponible pour le moment.</p>
    {% endif %}
{% endblock %}
