{% extends "pilot/base.html" %}

{% block title %}{{ kpi.nom }} â€“ DÃ©tail KPI{% endblock %}

{% block content %}
    <h1 class="text-2xl font-bold mb-4 text-cacf-green">{{ kpi.nom }}</h1>
    <div class="bg-white p-4 rounded-lg shadow mb-6 border border-cacf-mediumgray">
        <p><strong>Valeur actuelle :</strong> {{ kpi.valeur_actuelle }}</p>
        <p><strong>Objectif :</strong> {{ kpi.objectif }}</p>
        <p><strong>Ã‰cart :</strong> 
            {% if kpi.ecart > 0 %}
                <span class="text-cacf-green font-bold">+{{ kpi.ecart }}</span>
            {% elif kpi.ecart < 0 %}
                <span class="text-cacf-alert font-bold">{{ kpi.ecart }}</span>
            {% else %}
                <span class="text-cacf-mediumgray">0</span>
            {% endif %}
        </p>
        <p class="text-sm text-cacf-mediumgray mt-2">Date : {{ kpi.date }}</p>
    </div>

    <h2 class="text-xl font-semibold mb-3">ðŸ’¬ Commentaires</h2>
    {% for commentaire in kpi.commentaires.all %}
        <div class="bg-cacf-gray p-3 rounded mb-2">
            <p class="text-sm text-gray-700">{{ commentaire.contenu }}</p>
            <p class="text-xs text-cacf-mediumgray">â€“ {{ commentaire.utilisateur.username }} | {{ commentaire.date_creation|date:"d/m/Y H:i" }}</p>
        </div>
    {% empty %}
        <p class="text-cacf-mediumgray">Aucun commentaire pour lâ€™instant.</p>
    {% endfor %}

    {% if user.is_authenticated %}
        <form method="post" class="mt-6">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="mt-2 bg-cacf-green text-white px-4 py-2 rounded hover:bg-cacf-dark">
                Ajouter un commentaire
            </button>
        </form>
    {% else %}
        <p class="mt-4 text-cacf-mediumgray">Connectez-vous pour ajouter un commentaire.</p>
    {% endif %}
{% endblock %}
